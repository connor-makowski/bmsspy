\begin{algorithm}[!htbp]
\SingleSpacedXI
\caption{Find Pivots (\texttt{BmsspSolver.find\_pivots})}
\label{alg:bmssp_find_pivots}
\SetAlgoLined
\KwIn{upper bound $B$, frontier $S$}
\KwOut{pivot set $P$, temporary frontier $W$}
$W\leftarrow S$; {\color{Fuchsia}$W_{\mathrm{prev}}$}$\leftarrow S$\;
\For{$1$ \KwTo $k$ iterations}{
  {\color{Fuchsia}$W_{\mathrm{curr}}$}$\leftarrow\emptyset$\;
  \ForEach{$u\in$ {\color{Fuchsia}$W_{\mathrm{prev}}$}}{
    \ForEach{$(v,w)\in G[u]$}{
      {\color{ForestGreen}$d'\leftarrow \textit{cdist}[u] + w + counter\_value + \textit{edge\_adj}[u][v]$\tcp*{Unique distance}}
      \If{$d'\le \textit{dist}[v]$}{
          $\textit{dist}[v]\leftarrow d'$\;
          {\color{ForestGreen}$\textit{pred}[v]\leftarrow u$\tcp*{Update predecessor}\label{alg:bmssp_find_pivots_pred}}
          {\color{ForestGreen} $\textit{cdist}[v]\leftarrow \textit{cdist}[u] + w + counter\_value$\tcp*{Update counter distance}\label{alg:bmssp_find_pivots_counter_dist_update}}
        \If{$d'<B$}{{\color{Fuchsia}$W_{\mathrm{curr}}$}$\leftarrow$ {\color{Fuchsia}$W_{\mathrm{curr}}$}$\cup\{v\}$}
      }
    }
  }
  $W\leftarrow W\cup$ {\color{Fuchsia}$W_{\mathrm{curr}}$}\;
  \If{$|W|>k|S|$}{\Return{$(S,W)$}}
  {\color{Fuchsia}$W_{\mathrm{prev}}$}$\leftarrow$ {\color{Fuchsia}$W_{\mathrm{curr}}$}\;
}
\BlankLine
{\color{Bittersweet}
$F \leftarrow \{u \mapsto \emptyset : u \in W\}$\tcp*{Create an empty forest $F$ to be filled}\label{alg:bmssp_find_pivots_forest_expansion}
$\text{indegreeF} \leftarrow \{u \mapsto 0 : u \in W\}$\tcp*{Create an empty $indegreeF$ to be filled}

\ForEach{$u\in W$}{
  \ForEach{$(v,w)\in G[u]$}{
    {\color{ForestGreen}$d'\leftarrow \textit{cdist}[u] + w + counter\_value + \textit{edge\_adj}[u][v]$\tcp*{Unique Distance}}
    \If{$v\in W$ \textbf{and} $d'=\textit{dist}[v]$}{
      $F[u]\leftarrow F[u]\cup\{v\}$\;
      $\text{indegreeF}[v]\leftarrow \text{indegreeF}[v]+1$\;
    }
  }
}
\BlankLine
$P\leftarrow\emptyset$\;
\ForEach{$u \in S$}{
  \If{$\text{indegreeF}[u] = 0$}{
    \If{$\textsc{IsPivot}(u, F, k)$}{
      $P \leftarrow P \cup \{u\}$
    }
  }
}
}
\Return{$(P,W)$}\;
\end{algorithm}