\begin{algorithm}[!htbp]
\SingleSpacedXI
\caption{Recursive BMSSP (\texttt{BmsspCore.recursive\_bmssp})}
\label{alg:bmssp_recursive_bmssp}
\SetAlgoLined
\KwIn{depth $l$, bound $B$, frontier $S$}
\KwOut{$(B_{\mathrm{comp}},U)$}

\If{$l=0$}{
  \Return $(B_{\mathrm{comp}}, U) \leftarrow$ \textsc{BaseCase}($B,S$)\;
}

$(P,W) \leftarrow$ \textsc{FindPivots}($B,S$)\;
$D \leftarrow$  \textsc{BmsspDataStructure}($M,B$) with $M=2^{(l-1)t}$\;
\ForEach{$p \in P$}{$D.\textsc{Insert}(p, \textit{dist}[p])$}

{\color{Blue}$B_{\mathrm{comp}}$} $\leftarrow \min(\{\textit{dist}[p] : p \in P\}\cup\{B\})$; $U \leftarrow \emptyset$\;

\While{$|U| < k \cdot 2^{lt}$ and $\neg D.\textsc{IsEmpty}()$}{
  ({\color{Blue}$B_{\mathrm{curr}}$},{\color{Blue}$S_{\mathrm{curr}}$}) $\leftarrow D.\textsc{Pull}()$\;
  ({\color{Blue}$B_{\mathrm{comp}}$},{\color{Blue}$U_{\mathrm{curr}}$}) $\leftarrow$ \textsc{RecursiveBMSSP}($l-1$,{\color{Blue}$B_{\mathrm{curr}}$},{\color{Blue}$S_{\mathrm{curr}}$})\;
  $U \leftarrow U \cup$ {\color{Blue}$U_{\mathrm{curr}}$}\;
  $K \leftarrow \emptyset$\;

  \ForEach{$u \in$ {\color{Blue}$U_{\mathrm{curr}}$}}{
    \ForEach{$(v,w) \in G[u]$}{
      {\color{Sepia}$d' \leftarrow \textit{cdist}[u]+w+counter+G_{edge}[u][v]$\tcp*{Unique distance}}
      \If{$d' \leq \textit{dist}[v]$}{
        $\textit{dist}[v]\leftarrow d'$\;
        {\color{ForestGreen}$\textit{pred}[v]\leftarrow u$\tcp*{Update predecessor}\label{alg:bmssp_recursive_bmssp_pred}}
        {\color{Sepia}$\textit{cdist}[v]\leftarrow \textit{cdist}[u]+w+counter$\tcp*{Update counter distance}}
        \uIf{{\color{Blue}$B_{\mathrm{curr}}$}$ \leq d' < B$}{ $D.\textsc{Insert}(v,d')$ }
        \ElseIf{{\color{Blue}$B_{\mathrm{comp}}$}$ \leq d' < $ {\color{Blue}$B_{\mathrm{curr}}$}}{ $K \leftarrow K \cup \{(v,d')\}$ }
      }
    }
  }

  $D.\textsc{BatchPrepend}(K \cup \{(x,\textit{dist}[x]) : x \in$ {\color{Blue}$S_{\mathrm{curr}}$}$, ${\color{Blue}$B_{\mathrm{comp}}$}$ \leq \textit{dist}[x] < $ {\color{Blue}$B_{\mathrm{curr}}$}$\})$\;
}
$B_{\mathrm{comp}} \leftarrow \min(B_{\mathrm{comp}}, B)$\;
\Return $(B_{\mathrm{comp}},U \leftarrow U \cup \{x \in W : \textit{dist}[x] < B_{\mathrm{comp}}\})$\;


\end{algorithm}